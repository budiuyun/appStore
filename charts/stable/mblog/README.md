# mblog

一个支持自部署的前后端分离的微博系统，可单用户或多用户使用

## 应用介绍

本应用提供以下功能：
- 图文混发：支持文字、图片、文件等内容发布，支持多图
- 标签系统：便于内容分类和管理
- 灵活部署：支持前后端分离或一体化部署
- 多数据库支持：可使用MySQL或SQLite
- 多用户系统：支持单用户或多用户模式
- 内容可见性：支持公开、登录可见或仅自己可见
- 搜索功能：按标签、时间、内容、可见性搜索
- 响应式设计：适配PC和移动设备，支持夜间模式
- 丰富扩展：支持Markdown语法、emoji表情、RSS订阅

## 配置说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| 镜像标签 | mblog版本 | `latest` |
| 服务端口 | Web服务端口 | `38321` |
| 资源限制 | CPU和内存限制 | 见下文 |
| 持久化存储 | 数据存储配置 | 见下文 |

### 资源配置
- CPU限制: 500m（相当于0.5核心）
- 内存限制: 512Mi（相当于512MB）
- CPU请求: 200m（相当于0.2核心）
- 内存请求: 256Mi（相当于256MB）

### 持久化存储配置
- 启用持久化: true（建议开启）
- 挂载路径: /opt/mblog
- 存储大小: 2Gi（可根据需求调整）
- 存储类: local（取决于集群环境）

## 数据存储

mblog的数据默认存储在容器的 `/opt/mblog` 目录中。使用SQLite时，数据库文件位于 `/opt/mblog/data.sqlite`。启用持久化存储后，数据将保存在持久卷中，即使容器重启也不会丢失。

**提示**：如果选择本地存储图片，请确保分配足够的存储空间。

## 使用说明

1. 部署应用后，可通过以下方式访问服务：
   - Web界面：访问服务的38321端口

2. 首次访问时：
   - 使用默认用户名密码登录：admin/a123456
   - 登录后请立即在用户设置页面修改密码
   - 在系统设置中配置服务端域名和安全域名

3. 内容发布：
   - 支持文字、图片、文件等混合发布
   - 第一行以#开头的文字会被解析为标签
   - 支持Markdown语法和emoji表情

4. 内容管理：
   - 支持按标签、时间、内容搜索
   - 可设置内容可见性（公开/登录可见/仅自己可见）
   - 支持标签管理和内容编辑

## 环境变量配置

| 环境变量 | 描述 | 默认值 |
|---------|------|--------|
| DB_TYPE | 数据库类型，为空时默认mysql，-sqlite表示使用SQLite | `-sqlite` |
| MYSQL_USER | MySQL数据库用户名，使用SQLite时可忽略 | `` |
| MYSQL_PASS | MySQL数据库密码，使用SQLite时可忽略 | `` |
| MYSQL_URL | MySQL数据库地址和端口，使用SQLite时可忽略 | `` |
| MYSQL_DB | MySQL数据库名称，使用SQLite时可忽略 | `` |
| MBLOG_FRONT_DOMAIN | mblog前端地址，前后不分离版本忽略此参数 | `` |
| JAVA_OPTS | Java内存设置，建议最低不要低于256m | `-Xms512m -Xmx512m` |
| AUTO_EXECUTE_SQL | 是否自动执行SQL脚本 | `true` |
| ENABLE_SWAGGER | 是否开启Swagger API文档 | `false` |

## 部署模式

### 前后不分离模式（推荐新手使用）

使用SQLite数据库的前后不分离模式是最简单的部署方式，只需要一个容器即可运行完整的mblog系统。

### 前后分离模式

如果您希望前端部署在CDN上，后端部署在NAS或服务器上，可以选择前后分离模式。这种模式下需要：

1. 部署后端服务，配置MBLOG_FRONT_DOMAIN环境变量
2. 部署前端服务，配置后端服务地址
3. 确保前端域名已添加到后端的安全域名列表中

## 图片存储

mblog支持多种图片存储方式：

1. 本地存储：默认方式，图片存储在服务器本地
2. 七牛云存储：需要在系统设置中配置七牛云参数
3. S3兼容存储：支持Amazon S3或兼容S3协议的存储服务

## 安全注意事项

- 生产环境中请修改默认管理员密码
- 考虑使用HTTPS保护用户数据
- 定期备份数据库和上传的文件
- 合理配置用户注册和评论权限

## 常见问题

1. 无法访问Web界面：
   - 检查服务是否正常运行
   - 确认端口映射是否正确
   - 检查容器日志

2. 数据库连接问题：
   - 使用MySQL时，确认数据库连接信息正确
   - 确认数据库用户有创建表的权限
   - MySQL 5.7需要特殊配置，请参考文档

3. 前后端分离问题：
   - 确认前端域名已添加到后端安全域名中
   - 检查跨域配置是否正确

## 安装方法
